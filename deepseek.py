from openai import OpenAI

import data
from config import deepseek_token


def simple_ask(prompt):
    client = OpenAI(api_key=deepseek_token,
                    base_url="https://api.deepseek.com")

    response = client.chat.completions.create(
        model="deepseek-chat",
        messages=[
            {"role": "system", "content": "You are a helpful assistant"},
            {"role": "user", "content": prompt},
        ],
        stream=False
    )

    return response.choices[0].message.content


def ask_context(prompt, context):
    system_prompt = f"""
    –¢—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–¥–∞–≤–µ—Ü-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –∫–æ–º–ø–∞–Ω–∏–∏. –û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. 
    –ï—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ‚Äì –≤–µ–∂–ª–∏–≤–æ –æ—Ç–∫–∞–∂–∏—Å—å –æ—Ç–≤–µ—á–∞—Ç—å. –°–æ—Ö—Ä–∞–Ω—è–π –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –∏ —É–≤–µ—Ä–µ–Ω–Ω—ã–π —Ç–æ–Ω.

    **–†–æ–ª—å:**
    - –≠–∫—Å–ø–µ—Ä—Ç –ø–æ –ø—Ä–æ–¥—É–∫—Ç–∞–º/—É—Å–ª—É–≥–∞–º –∫–æ–º–ø–∞–Ω–∏–∏
    - –ú–∞—Å—Ç–µ—Ä –≤–µ–∂–ª–∏–≤–æ–≥–æ –æ–±—â–µ–Ω–∏—è
    - –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ —Ä–µ—à–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º –∫–ª–∏–µ–Ω—Ç–æ–≤

    **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:**
    1. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π: <CONTEXT_START>{context}<CONTEXT_END>
    2. –û—Ç–≤–µ—á–∞–π –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –Ω–∞ –≤–æ–ø—Ä–æ—Å: {prompt}
    3. –ï—Å–ª–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞: "–ò–∑–≤–∏–Ω–∏—Ç–µ, —ç—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –£—Ç–æ—á–Ω–∏—Ç–µ –¥–µ—Ç–∞–ª–∏ —É –º–µ–Ω–µ–¥–∂–µ—Ä–∞"
    4. –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ —Ä–∞–∑–±–∏–≤–∞–π –æ—Ç–≤–µ—Ç –Ω–∞ –ø—É–Ω–∫—Ç—ã
    5. –ò–∑–±–µ–≥–∞–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∂–∞—Ä–≥–æ–Ω–∞

    **–°—Ç–∏–ª—å –æ—Ç–≤–µ—Ç–∞:**
    - –ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∂–∏ –¥–ª—è —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –æ–∫—Ä–∞—Å–∫–∏ (1-2 –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏)
    - –ü–æ–¥—á–µ—Ä–∫–∏–≤–∞–π –≤—ã–≥–æ–¥—ã –∫–ª–∏–µ–Ω—Ç–∞
    - –ü—Ä–µ–¥–ª–∞–≥–∞–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã: "–í–æ–∑–º–æ–∂–Ω–æ –≤–∞—Å —Ç–∞–∫–∂–µ –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç..."
    - –ó–∞–≤–µ—Ä—à–∞–π –≤–æ–ø—Ä–æ—Å–æ–º: "–•–æ—Ç–∏—Ç–µ —É—Ç–æ—á–Ω–∏—Ç—å –∫–∞–∫–∏–µ-—Ç–æ –¥–µ—Ç–∞–ª–∏?"

    **–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
    "–î–æ–±—Ä—ã–π –¥–µ–Ω—å! <–æ—Å–Ω–æ–≤–Ω–æ–π –æ—Ç–≤–µ—Ç –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞>. 
    –ù—É–∂–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏? üòä"

    **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è:**
    - –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ–±—Ä–µ–∑–∞–Ω –¥–æ 512 —Ç–æ–∫–µ–Ω–æ–≤
    - –ò–∑–±–µ–≥–∞–π markdown-—Ä–∞–∑–º–µ—Ç–∫–∏
    - –û—Ç–≤–µ—Ç –¥–µ—Ä–∂–∏ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
    """

    client = OpenAI(api_key=deepseek_token,
                    base_url="https://api.deepseek.com")

    response = client.chat.completions.create(
        model="deepseek-chat",
        messages=[
            {"role": "system", "content": system_prompt},
            {"role": "user", "content": prompt},
        ],
        stream=False
    )

    return response.choices[0].message.content


if __name__ == '__main__':

    prompt = '–ö–∞–∫ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –º–∏–ª–ª–∏–æ–Ω –º–æ–ª–æ–¥–æ–º—É —á–µ–ª–æ–≤–µ–∫—É'

    print(simple_ask(prompt))

    print('-\n\n' * 3)

    context = data.find_text(prompt)
    print(ask_context(prompt, context))
